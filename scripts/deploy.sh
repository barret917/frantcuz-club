#!/bin/bash

set -e

# ะฆะฒะตัะฐ
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

info() { echo -e "${GREEN}โ${NC} $1"; }
warn() { echo -e "${YELLOW}โ${NC} $1"; }
error() { echo -e "${RED}โ${NC} $1"; }

echo "๐ ะะฐัะธะฝะฐะตะผ ะดะตะฟะปะพะน ะฟัะพะตะบัะฐ Frantsuz Club"
echo ""

# 1. ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd /home/maga/frantsuz-club

# 2. ะกะพะฑะธัะฐะตะผ ะฑัะบะตะฝะด
info "ะกะพะฑะธัะฐะตะผ ะฑัะบะตะฝะด..."
cd backend
npm run build
info "ะัะบะตะฝะด ัะพะฑัะฐะฝ"

# 3. ะกะพะฑะธัะฐะตะผ ััะพะฝัะตะฝะด
info "ะกะพะฑะธัะฐะตะผ ััะพะฝัะตะฝะด..."
cd ../frontend
npm run build
info "ะคัะพะฝัะตะฝะด ัะพะฑัะฐะฝ"

# 4. ะะตัะตัะพะดะธะผ ะฒ ะบะพัะตะฝั ะฟัะพะตะบัะฐ
cd ..

# 5. ะะตัะตะทะฐะฟััะบะฐะตะผ Docker ะบะพะฝัะตะนะฝะตัั
info "ะะตัะตัะพะฑะธัะฐะตะผ ะธ ะฟะตัะตะทะฐะฟััะบะฐะตะผ Docker ะบะพะฝัะตะนะฝะตัั..."
docker-compose -f docker-compose.production.yml down
docker-compose -f docker-compose.production.yml up -d --build

# 6. ะัะพะฒะตััะตะผ ััะฐััั
info "ะัะพะฒะตััะตะผ ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ..."
docker-compose -f docker-compose.production.yml ps

echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
info "โ ะะตะฟะปะพะน ะทะฐะฒะตััะตะฝ ััะฟะตัะฝะพ!"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "ะัะพะฒะตัััะต ััะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ:"
echo "  docker-compose -f docker-compose.production.yml ps"
echo ""
echo "ะะพัะผะพััะธัะต ะปะพะณะธ:"
echo "  docker-compose -f docker-compose.production.yml logs -f"
echo ""

