# ü§ñ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram –ë–æ—Ç–∞ —Å Backend API

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `telegramUserId` –≤ –º–æ–¥–µ–ª—å EventTicket**
- –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –±–∏–ª–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ü–æ–ª–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ (`String?`)
- –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞: `20251008193242_add_telegram_user_id_to_tickets`

### 2. **–°–æ–∑–¥–∞–Ω —Ä–æ—É—Ç–µ—Ä `/api/bot`**
- –í—Å–µ endpoints –±–æ—Ç–∞ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É `/api/bot`
- –ê–¥–∞–ø—Ç–µ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –±–æ—Ç–æ–º

### 3. **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ endpoints**

---

## üìã API Endpoints –¥–ª—è Telegram –ë–æ—Ç–∞

### **BASE URL**: `http://localhost:3002/api/bot`

---

### 1. **–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–æ–±—ã—Ç–∏—è**
```
GET /api/bot/events
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "name": "–î–∂–∞–∑–æ–≤—ã–π –≤–µ—á–µ—Ä",
    "startsAt": "2024-10-15T19:00:00.000Z",
    "description": "–í–µ—á–µ—Ä –∂–∏–≤–æ–π –º—É–∑—ã–∫–∏",
    "hall": {
      "name": "Frantsuz Club"
    },
    "eventZonePrices": [
      {
        "zoneId": 1,
        "pricePerSeat": 1500,
        "zone": {
          "name": "VIP –∑–æ–Ω–∞"
        }
      }
    ]
  }
]
```

---

### 2. **–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–æ–Ω—ã**
```
GET /api/bot/events/:eventId/zones/:zoneId/availability
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `eventId` - ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
- `zoneId` - ID –∑–æ–Ω—ã

**–û—Ç–≤–µ—Ç:**
```json
{
  "zoneId": 1,
  "zoneName": "VIP –∑–æ–Ω–∞",
  "totalSeats": 20,
  "soldSeats": 5,
  "availableSeats": 15,
  "pricePerSeat": 1500
}
```

---

### 3. **–ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç—ã (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ)**
```
POST /api/bot/tickets
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "eventId": 1,
  "zoneId": 1,
  "customerName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "customerPhone": "+79991234567",
  "customerEmail": "ivan@example.com",
  "seatsCount": 3,
  "telegramUserId": "123456789"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "ticketPurchase": {
    "id": 1,
    "ticketIds": [1, 2, 3],
    "ticketNumbers": ["FR-241008-1234", "FR-241008-1235", "FR-241008-1236"],
    "eventName": "–î–∂–∞–∑–æ–≤—ã–π –≤–µ—á–µ—Ä",
    "zoneName": "VIP –∑–æ–Ω–∞",
    "seatsCount": 3,
    "totalAmount": 4500,
    "pricePerSeat": 1500,
    "status": "reserved",
    "paymentId": "pk_12345",
    "paymentUrl": "https://paykeeper.ru/pay/...",
    "createdAt": "2024-10-08T19:00:00.000Z",
    "expiresAt": "2024-10-08T19:10:00.000Z"
  },
  "message": "–ë–∏–ª–µ—Ç—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –æ–ø–ª–∞—Ç–µ"
}
```

**–õ–æ–≥–∏–∫–∞:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –±–∏–ª–µ—Ç—ã –ø–æ —Å—Ç–æ–ª–∞–º —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –º–µ—Å—Ç–∞–º–∏
- –°–æ–∑–¥–∞–µ—Ç –µ–¥–∏–Ω—ã–π –ø–ª–∞—Ç–µ–∂ –¥–ª—è –≤—Å–µ—Ö –±–∏–ª–µ—Ç–æ–≤
- –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç –±–∏–ª–µ—Ç—ã –Ω–∞ 10 –º–∏–Ω—É—Ç
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç 5 –º–µ—Å—Ç, –∞ —Å—Ç–æ–ª—ã –ø–æ 4 –º–µ—Å—Ç–∞, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
  - –ë—Ä–æ–Ω–∏—Ä—É–µ—Ç 4 –º–µ—Å—Ç–∞ –∑–∞ —Å—Ç–æ–ª–æ–º ‚Ññ1
  - –ë—Ä–æ–Ω–∏—Ä—É–µ—Ç 1 –º–µ—Å—Ç–æ –∑–∞ —Å—Ç–æ–ª–æ–º ‚Ññ2

---

### 4. **–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∏–ª–µ—Ç–µ**
```
GET /api/bot/tickets/:ticketId
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ticketId` - ID –±–∏–ª–µ—Ç–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": 1,
  "ticketNumber": "FR-241008-1234",
  "eventName": "–î–∂–∞–∑–æ–≤—ã–π –≤–µ—á–µ—Ä",
  "zoneName": "VIP –∑–æ–Ω–∞",
  "tableName": "–°—Ç–æ–ª 1",
  "price": 1500,
  "totalAmount": 1500,
  "seatsCount": 1,
  "status": "paid",
  "customerName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "customerPhone": "+79991234567",
  "customerEmail": "ivan@example.com",
  "qrCode": "data:image/png;base64,...",
  "paymentId": "pk_12345",
  "createdAt": "2024-10-08T19:00:00.000Z",
  "purchasedAt": "2024-10-08T19:05:00.000Z",
  "eventDate": "2024-10-15T19:00:00.000Z",
  "eventTime": "19:00"
}
```

---

### 5. **–ü–æ–ª—É—á–∏—Ç—å –±–∏–ª–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```
GET /api/bot/tickets/user/:telegramUserId
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `telegramUserId` - Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (chatId)

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "ticketNumber": "FR-241008-1234",
    "eventName": "–î–∂–∞–∑–æ–≤—ã–π –≤–µ—á–µ—Ä",
    "zoneName": "VIP –∑–æ–Ω–∞",
    "tableName": "–°—Ç–æ–ª 1",
    "price": 1500,
    "totalAmount": 1500,
    "seatsCount": 1,
    "status": "paid",
    "customerName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "customerPhone": "+79991234567",
    "customerEmail": "ivan@example.com",
    "qrCode": "data:image/png;base64,...",
    "createdAt": "2024-10-08T19:00:00.000Z",
    "purchasedAt": "2024-10-08T19:05:00.000Z",
    "eventDate": "2024-10-15T19:00:00.000Z",
    "eventTime": "19:00"
  }
]
```

---

### 6. **–ü–æ–ª—É—á–∏—Ç—å QR-–∫–æ–¥ –±–∏–ª–µ—Ç–∞**
```
GET /api/bot/tickets/:ticketId/qr
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ticketId` - ID –±–∏–ª–µ—Ç–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "ticket": {
    "id": 1,
    "ticketNumber": "FR-241008-1234"
  },
  "qrCode": "data:image/png;base64,iVBORw0KGg..."
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤

---

### 7. **–ü–æ–ª—É—á–∏—Ç—å –±–∏–ª–µ—Ç —Å QR-–∫–æ–¥–æ–º**
```
GET /api/bot/tickets/:ticketId/with-qr
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ticketId` - ID –±–∏–ª–µ—Ç–∞

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "ticket": {
    "id": 1,
    "ticketNumber": "FR-241008-1234",
    "eventName": "–î–∂–∞–∑–æ–≤—ã–π –≤–µ—á–µ—Ä",
    "zoneName": "VIP –∑–æ–Ω–∞",
    "tableName": "–°—Ç–æ–ª 1"
  },
  "qrCode": "data:image/png;base64,iVBORw0KGg..."
}
```

---

### 8. **–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±–∏–ª–µ—Ç–∞**
```
PATCH /api/bot/tickets/:ticketId/status
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "status": "paid"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "ticket": { ... }
}
```

---

### 9. **–ü–æ–ª—É—á–∏—Ç—å –∑–∞–ª—ã (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)**
```
GET /api/bot/halls
```

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "name": "Frantsuz Club",
    "description": "–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ª"
  }
]
```

---

### 10. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**
```
GET /api/bot/stats
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "service": "Frantsuz Club Bot API",
  "version": "1.0.0"
}
```

---

## üîÑ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ –±–æ—Ç–µ

### **–ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å** –≤ –±–æ—Ç–µ `websiteApiService.js`:

URL —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π! –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```javascript
// frantsuz_bot/.env –∏–ª–∏ docker.safe.env
WEBSITE_API_URL=http://localhost:3002/api/bot
```

### **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö:**

#### –ë—ã–ª–æ (–±–æ—Ç –æ–∂–∏–¥–∞–ª):
```javascript
event.name
event.startsAt
event.eventZonePrices
```

#### –°—Ç–∞–ª–æ (backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç):
```javascript
event.name          // ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ
event.startsAt      // ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ
event.eventZonePrices // ‚úÖ –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–æ
```

–í—Å–µ –ø–æ–ª—è —Ç–µ–ø–µ—Ä—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è** —á–µ—Ä–µ–∑ `botController`!

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∫—É–ø–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç 7 –º–µ—Å—Ç –≤ –∑–æ–Ω–µ

1. **Backend –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–æ–ª—ã:**
   - –°—Ç–æ–ª 1: 4 —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç–∞
   - –°—Ç–æ–ª 2: 4 —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç–∞
   - –°—Ç–æ–ª 3: 2 —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç–∞

2. **Backend —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç:**
   - 4 –±–∏–ª–µ—Ç–∞ ‚Üí –°—Ç–æ–ª 1
   - 3 –±–∏–ª–µ—Ç–∞ ‚Üí –°—Ç–æ–ª 2

3. **–°–æ–∑–¥–∞–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π –ø–ª–∞—Ç–µ–∂** –Ω–∞ –≤—Å—é —Å—É–º–º—É

4. **–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:**
   - –í—Å–µ 7 –±–∏–ª–µ—Ç–æ–≤ –ø–æ–ª—É—á–∞—é—Ç —Å—Ç–∞—Ç—É—Å `paid`
   - –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è 7 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö QR-–∫–æ–¥–æ–≤
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email —Å 7 –±–∏–ª–µ—Ç–∞–º–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω email)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ:

```bash
cd backend
npm run dev
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
curl http://localhost:3002/api/bot/stats

# –ü–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏—è
curl http://localhost:3002/api/bot/events

# –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∑–æ–Ω—ã
curl http://localhost:3002/api/bot/events/1/zones/1/availability
```

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ

1. ‚úÖ Backend –≥–æ—Ç–æ–≤
2. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
3. ‚úÖ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
4. üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –±–æ—Ç–µ
5. üîÑ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∫—É–ø–∫—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ë–æ—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç –ø–æ–∫—É–ø–∞—Ç—å **–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ë–∏–ª–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Å—Ç–æ–ª–∞–º**
- –ö–∞–∂–¥—ã–π –±–∏–ª–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ `telegramUserId`
- QR-–∫–æ–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è **–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤**

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã - –ø–∏—à–∏!

